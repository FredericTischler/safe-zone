<div class="cart-container">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="toolbar">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="title">ðŸ›’ Mon Panier</span>
    <span class="spacer"></span>
    @if (cartItems.length > 0) {
      <button mat-button (click)="clearCart()">
        <mat-icon>delete_sweep</mat-icon>
        Vider le panier
      </button>
    }
  </mat-toolbar>

  <div class="content">
    @if (cartItems.length === 0) {
      <!-- Empty Cart -->
      <mat-card class="empty-card">
        <mat-icon>shopping_cart</mat-icon>
        <h2>Votre panier est vide</h2>
        <p>Ajoutez des produits pour commencer vos achats</p>
        <button mat-raised-button color="primary" (click)="continueShopping()">
          <mat-icon>storefront</mat-icon>
          Continuer mes achats
        </button>
      </mat-card>
    } @else {
      <!-- Cart Table -->
      <div class="cart-content">
        <mat-card class="table-card">
          <table mat-table [dataSource]="cartItems" class="cart-table">
            <!-- Image Column -->
            <ng-container matColumnDef="image">
              <th mat-header-cell *matHeaderCellDef>Image</th>
              <td mat-cell *matCellDef="let item">
                @if (item.imageUrl) {
                  <img [src]="item.imageUrl" [alt]="item.name" class="product-image">
                } @else {
                  <div class="no-image">
                    <mat-icon>image</mat-icon>
                  </div>
                }
              </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Produit</th>
              <td mat-cell *matCellDef="let item">
                <strong>{{ item.name }}</strong>
              </td>
            </ng-container>

            <!-- Price Column -->
            <ng-container matColumnDef="price">
              <th mat-header-cell *matHeaderCellDef>Prix unitaire</th>
              <td mat-cell *matCellDef="let item">
                {{ item.price | number:'1.2-2' }} â‚¬
              </td>
            </ng-container>

            <!-- Quantity Column -->
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef>QuantitÃ©</th>
              <td mat-cell *matCellDef="let item">
                <div class="quantity-controls">
                  <button 
                    mat-icon-button 
                    (click)="decreaseQuantity(item)"
                    [disabled]="item.quantity <= 1">
                    <mat-icon>remove</mat-icon>
                  </button>
                  <span class="quantity-value">{{ item.quantity }}</span>
                  <button 
                    mat-icon-button 
                    (click)="increaseQuantity(item)">
                    <mat-icon>add</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <!-- Total Column -->
            <ng-container matColumnDef="total">
              <th mat-header-cell *matHeaderCellDef>Total</th>
              <td mat-cell *matCellDef="let item">
                <strong class="item-total">{{ getItemTotal(item) | number:'1.2-2' }} â‚¬</strong>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let item">
                <button 
                  mat-icon-button 
                  color="warn" 
                  (click)="removeItem(item)"
                  matTooltip="Retirer">
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </mat-card>

        <!-- Summary Card -->
        <mat-card class="summary-card">
          <h2>RÃ©sumÃ© de la commande</h2>
          
          <div class="summary-row">
            <span>Sous-total ({{ cartItems.length }} article{{ cartItems.length > 1 ? 's' : '' }})</span>
            <strong>{{ getTotal() | number:'1.2-2' }} â‚¬</strong>
          </div>

          <div class="summary-row">
            <span>Livraison</span>
            <strong>Gratuite</strong>
          </div>

          <mat-divider></mat-divider>

          <div class="summary-row total-row">
            <span>Total</span>
            <strong class="total-price">{{ getTotal() | number:'1.2-2' }} â‚¬</strong>
          </div>

          <button 
            mat-raised-button 
            color="primary" 
            class="checkout-btn"
            (click)="checkout()">
            <mat-icon>payment</mat-icon>
            ProcÃ©der au paiement
          </button>

          <button 
            mat-stroked-button 
            class="continue-btn"
            (click)="continueShopping()">
            <mat-icon>arrow_back</mat-icon>
            Continuer mes achats
          </button>
        </mat-card>
      </div>
    }
  </div>
</div>
